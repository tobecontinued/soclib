
# -*- python -*-

# This file holds default configuration file for SoCLib. You should
# not change it. You'd rather create or change file located in
# ~/.soclib/global.conf. See at end of file to see what files
# are included form here.

import os
import os.path

# Paths where modules are looked for:
for p in [
    'soclib/communication',
    'soclib/lib',
    'soclib/module',
    'soclib/iss',
    os.getcwd(),
    ]:
    # Relative paths are from soclib root directory
    config.addDescPath(p)

def _platform():
    """
    Retrieves platform information and make it look-like systemc's
    lib-xxx thing.
    """
    import sys
    pf = sys.platform

    # Strip numeric suffix from platform name
    while pf[-1] in "0123456789":
        pf = pf[:-1]

    if pf == 'darwin': pf = 'macosx'
    return pf

config.systemc = Library(
    name = 'systemc',
    vendor = 'OSCI',
    libdir = '%(dir)s/lib-%(os)s',
    includedir = '%(dir)s/include',
    libs = ['-L%(libdir)s', '-lsystemc', '-lpthread'],
    cflags = ['-I%(dir)s/include'],
    dir = "${SYSTEMC}",
    os = _platform(),
    )

config.toolchain = Toolchain(
    tool_CC = 'gcc',
    tool_CXX = 'g++',
    tool_CC_LINKER = 'gcc',
    tool_CXX_LINKER = 'g++',
    tool_LD = 'ld',
	obj_ext = 'o',
	lib_ext = 'a',
    
	prefix = '',
	vflags = [],
    cflags = ['-Wall', '-Wno-pmf-conversions', '-DSOCLIB',
              '-include', 'sys/types.h', '-include', 'inttypes.h',
              '-I'+config.path+'/soclib/lib/include',
              ],
    libs = ['-lpthread'],
    always_include = [], 
    release_cflags = ['-O2', '-DSOCLIB_MODE_RELEASE'],
	release_libs = [],
    prof_cflags = ['-pg', '-DSOCLIB_MODE_PROFILE'],
    prof_libs = ['-pg'],
    debug_cflags = ['-ggdb', '-DSOCLIB_MODE_DEBUG'],
	debug_libs = [],
    max_processes = 1,
    )

config.build_env = BuildEnv(
    libraries = [config.systemc],
    toolchain = config.toolchain,
    repos = "/tmp/build/sc",
    cache_file = "%(repos)s/soclib_cc.cache",
    sd_ignore_regexp = None,
    )

config.default = config.build_env

# Included files:
for p in [
    os.path.join(config.path, "utils/conf/soclib.conf"),
    os.path.expanduser("~/.soclib/global.conf"),
    "soclib.conf",
    ]:
    include(p, ignore_if_absent = True)
